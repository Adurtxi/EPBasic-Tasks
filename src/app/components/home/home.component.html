<div class="container mt-4" *ngIf="this.loading[0] == true">
    Cargando...
</div>
<div class="container-fluid mt-4 mb-5" *ngIf="this.loading[0] == false">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-12 mb-4">

            <div class="container mb-2">
                <div class="progress-group">
                    <div class="wrapper">
                        <div class="step complete">
                            <progress class="progress" value="100" max="100"></progress>
                            <div class="progress-circle"></div>
                        </div>
                        <div class="step complete">
                            <progress class="progress" value="100" max="100"></progress>
                            <div class="progress-circle"></div>
                        </div>
                        <div class="step complete">
                            <progress class="progress" value="100" max="100"></progress>
                            <div class="progress-circle"></div>
                        </div>
                        <div class="step complete">
                            <progress class="progress" value="0" max="100"></progress>
                            <div class="progress-circle"></div>
                        </div>
                        <div class="step step05">
                            <progress class="progress" value="0" max="100"></progress>
                            <div class="progress-circle"></div>
                        </div>
                    </div>
                    <div class="progress-labels">
                        <div class="label">Estudios</div>
                        <div class="label">Años</div>
                        <div class="label">Evaluaciones</div>
                        <div class="label">Asignaturas</div>
                        <div class="label">Horario</div>
                    </div>
                </div>
            </div>

            <div class="card rounded-25" *ngIf="!subjects || !subjects[0] && this.loading[0] == false">
                <div class="card-body">
                    <section>
                        <h3>Paso 1 de 3 | <b>Estudios</b></h3>
                        <hr class="bg-light mt-1">

                        <table class="table table-bordered mt-4">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th class="pointer" (click)="createStudy()">
                                        Añadir <i class="fas fa-plus text-primary ml-1"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let study of studies; let i=index">
                                    <td>{{ i + 1 }}</td>
                                    <td>
                                        <input type="text" class="form-control mb-2" [(ngModel)]="study.name" />
                                    </td>
                                    <td>
                                        <ng-container *ngIf="study.id == 0">
                                            <button class="btn btn-primary rounded-25 mr-2"
                                                (click)="storeStudy(study, i)" [disabled]="study.name == ''">
                                                <i class="fa fa-save"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25" (click)="deleteStudyFront(i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                        <ng-container *ngIf="study.id > 0">
                                            <button class="btn btn-secondary rounded-25 mr-2"
                                                (click)="updateStudy(study, i)">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25"
                                                (click)="deleteStudy(study.id, i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                        <button class="btn btn-primary rounded-25 float-right"
                                            (click)="selectStudy(study.id)">
                                            Seleccionar <i class="fas fa-sign-in-alt ml-1"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                    <section>
                        <h3>Paso 2 de 3 | <b>Años</b></h3>
                        <hr class="bg-light mt-1">

                        <table class="table table-bordered mt-4">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Inicio</th>
                                    <th>Fin</th>
                                    <th class="pointer" (click)="createYear()">
                                        Añadir <i class="fas fa-plus text-primary ml-1"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let year of years; let i=index">
                                    <td>{{ i + 1 }}</td>
                                    <td>
                                        <ngb-datepicker [(ngModel)]="year.start"></ngb-datepicker>
                                    </td>
                                    <td>
                                        <ngb-datepicker [(ngModel)]="year.end"></ngb-datepicker>
                                    </td>
                                    <td>
                                        <ng-container *ngIf="year.id == 0">
                                            <button class="btn btn-primary rounded-25 mr-2" (click)="storeYear(year, i)"
                                                [disabled]="year.start == null || year.end == null">
                                                <i class="fa fa-save"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25" (click)="deleteYearFront(i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                        <ng-container *ngIf="year.id > 0">
                                            <button class="btn btn-secondary rounded-25 mr-2"
                                                (click)="updateYear(year, i)">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25" (click)="deleteYear(year.id, i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                        <button class="btn btn-primary rounded-25 float-right"
                                            (click)="selectYear(year.id)">
                                            <i class="fas fa-sign-in-alt ml-1"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                    <section>
                        <h3>Paso 3 de 3 | <b>Evaluaciones</b></h3>
                        <hr class="bg-light mt-1">

                        <table class="table table-bordered mt-4">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Inicio</th>
                                    <th>Fin</th>
                                    <th class="pointer" (click)="createEvaluation()">
                                        Añadir <i class="fas fa-plus text-primary ml-1"></i>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let evaluation of evaluations; let i=index">
                                    <td>{{ i + 1 }}</td>
                                    <td>
                                        <ngb-datepicker [(ngModel)]="evaluation.start"></ngb-datepicker>
                                    </td>
                                    <td>
                                        <ngb-datepicker [(ngModel)]="evaluation.end"></ngb-datepicker>
                                    </td>
                                    <td>
                                        <ng-container *ngIf="evaluation.id == 0">
                                            <button class="btn btn-primary rounded-25 mr-2"
                                                (click)="storeEvaluation(evaluation, i)"
                                                [disabled]="evaluation.start == null || evaluation.end == null">
                                                <i class="fa fa-save"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25"
                                                (click)="deleteEvaluationFront(i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                        <ng-container *ngIf="evaluation.id > 0">
                                            <button class="btn btn-secondary rounded-25 mr-2"
                                                (click)="updateEvaluation(evaluation, i)">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button class="btn btn-danger rounded-25"
                                                (click)="deleteEvaluation(evaluation.id, i)">
                                                <i class="fa fa-trash"></i>
                                            </button>
                                        </ng-container>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                </div>
            </div>

            <div class="accordion" data-aos="zoom-in" *ngIf="subjects">
                <ng-container *ngFor="let subject of subjects; let i=index; let fst=first; let lst=last;">
                    <div class="card" [class.rounded-top-25]="fst == true" [class.rounded-bottom-25]="lst == true">
                        <div class="card-header pointer d-flex justify-content-between">
                            <h3 class="col-lg-10 m-1" (click)="collapse(subject.id)">
                                {{ subject.name }}
                            </h3>
                            <div class="col-lg-2 col-sm-2">
                                <button class="btn btn-sm btn-block btn-primary rounded-25"
                                    [routerLink]="['/subject', subject.id]">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="collapse show" [ngbCollapse]="isCollapsed(subject.id)">
                            <div class="card-body pb-1">
                                <div class="row">
                                    <div class="col-lg-4 col-md-4 mb-2">
                                        <b>Tareas</b>
                                        <hr class="mt-1 mb-1">
                                        <div class="card rounded-25 mt-2"
                                            *ngFor="let task of subject.tasks; let e=index">
                                            <div class="card-body d-flex justify-content-between pb-1 pt-1"
                                                *ngIf="task.id != 0">
                                                <div class="col-lg-10 pointer pl-0" [routerLink]="['/task/', task.id]">
                                                    <span>{{ task.title }}</span>
                                                </div>

                                                <i class="fas fa-check-circle text-primary mt-1 pointer"
                                                    (click)="markTaskDone(i, e)" *ngIf="task.id != 0"
                                                    [class.fas]="task.done == true" [class.far]="task.done == false">
                                                </i>
                                            </div>
                                        </div>
                                        <span class="small" *ngIf="!subject.tasks || !subject.tasks[0]">No tienes tareas
                                            pendientes</span>
                                    </div>
                                    <div class="col-lg-4 col-md-4 mb-2">
                                        <b>Examenes</b>
                                        <hr class="mt-1 mb-2">
                                        <div class="card rounded-25 mb-2 mt-2"
                                            *ngFor="let exam of subject.exams; let e=index">
                                            <div class="card-body d-flex justify-content-between pb-1 pt-1"
                                                *ngIf="exam.id != 0">
                                                <div class="col-lg-10 pointer pl-0" [routerLink]="['/exam/', exam.id]">
                                                    <span>{{ exam.title }}</span>
                                                </div>

                                                <i class="fas fa-check-circle text-primary mt-1 pointer"
                                                    (click)="markExamDone(i, e)" [class.fas]="exam.done == true"
                                                    [class.far]="exam.done == false"
                                                    [class.text-danger]="exam.mark < 5 && exam.done == true"
                                                    [class.text-warning]="exam.mark == 5 && exam.done == true"
                                                    [class.text-success]="exam.mark > 5 && exam.done == true">
                                                </i>
                                            </div>
                                            <div class="card-body d-flex justify-content-between pb-1 pt-1"
                                                *ngIf="exam.id == 0">
                                                <span>{{ exam.title }}</span>
                                                <span class="badge badge-warning float-right" container="body"
                                                    placement="top" ngbTooltip="Examen sin guardar">
                                                    <i class="fas fa-save"></i>
                                                </span>
                                            </div>
                                        </div>
                                        <span class="small" *ngIf="!subject.exams || !subject.exams[0]">
                                            No tienes examenes pendientes
                                        </span>
                                    </div>
                                    <div class="col-lg-4 col-md-4">
                                        <b>Proyectos</b>
                                        <hr class="mt-1 mb-1">
                                        <span class="small" *ngIf="!subject.projects || !subject.projects[0]">
                                            No tienes proyectos pendientes
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
        <div class="col-lg-2">
            <div class="card rounded-25 bg-dark text-light" *ngIf="timetable" data-aos="zoom-in">
                <div class="card-header rounded-top-25 d-flex justify-content-between">
                    <h3>Horario
                        <span *ngIf="subjectsOfTomorrow == true">de mañana</span>
                    </h3>
                    <span>{{ dayHour }}</span>
                </div>
                <div class="card-body pb-0 pt-0">
                    <p class="mt-2 text-center" *ngIf="!subjectsOfDay[0]">¡Disfruta del fin de semana!</p>
                    <ng-container *ngIf="subjectsOfDay && subjectsOfDay[0]">
                        <hr class="bg-light">
                        <div *ngFor="let subject of subjectsOfDay; let i=index">
                            <div [routerLink]="['/subject', findSubject(subject.subject_id).id]" class="pointer">
                                <span
                                    [class.subjectNow]="inSubjectTime(this.timetable.hours[i].hour_start, this.timetable.hours[i].hour_end) == true">
                                    {{ findSubject(subject.subject_id).name }}
                                </span>
                                <div class="float-right circle"
                                    [ngStyle]="{ background: findSubject(subject.subject_id).primary_color }"></div>
                            </div>
                            <hr class="bg-light">
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="card rounded-25 mb-4"
                *ngIf="!subjects && this.loading[1] == false || !subjects[0] && this.loading[1] == false"
                data-aos="zoom-in">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <b>Tutorial</b>
                    </div>
                    <hr class="mt-1 mb-1">
                    Parece que aún no has añadido asignaturas, añadelas <b class="pointer text-primary"
                        routerLink="/subjects">aquí</b>
                </div>
            </div>
            <div class="card rounded-25" *ngIf="!timetable && this.loading[0] == false" data-aos="zoom-in">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <b>Tutorial</b>
                    </div>
                    <hr class="mt-1 mb-1">
                    Parece que aún no has generado un horario, generalo <b class="pointer text-primary"
                        routerLink="/timetable">aquí</b>
                </div>
            </div>
        </div>
    </div>
</div>